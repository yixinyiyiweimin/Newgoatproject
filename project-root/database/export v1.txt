-- COMPREHENSIVE SCHEMA EXPORT (Run this one)
-- Part 1: All columns with their properties
SELECT 
    'COLUMN' as info_type,
    c.table_schema,
    c.table_name,
    c.column_name,
    c.ordinal_position,
    c.data_type,
    c.character_maximum_length,
    c.numeric_precision,
    c.is_nullable,
    c.column_default,
    NULL as constraint_name,
    NULL as constraint_type,
    NULL as foreign_table,
    NULL as foreign_column,
    NULL as update_rule,
    NULL as delete_rule
FROM information_schema.columns c
WHERE c.table_schema NOT IN ('pg_catalog', 'information_schema')

UNION ALL

-- Part 2: All constraints (PK, FK, UNIQUE, CHECK)
SELECT 
    'CONSTRAINT' as info_type,
    tc.table_schema,
    tc.table_name,
    kcu.column_name,
    NULL as ordinal_position,
    NULL as data_type,
    NULL as character_maximum_length,
    NULL as numeric_precision,
    NULL as is_nullable,
    NULL as column_default,
    tc.constraint_name,
    tc.constraint_type,
    ccu.table_name AS foreign_table,
    ccu.column_name AS foreign_column,
    rc.update_rule,
    rc.delete_rule
FROM information_schema.table_constraints tc
LEFT JOIN information_schema.key_column_usage kcu 
    ON tc.constraint_name = kcu.constraint_name 
    AND tc.table_schema = kcu.table_schema
LEFT JOIN information_schema.constraint_column_usage ccu 
    ON tc.constraint_name = ccu.constraint_name
    AND tc.constraint_type = 'FOREIGN KEY'
LEFT JOIN information_schema.referential_constraints rc
    ON tc.constraint_name = rc.constraint_name
WHERE tc.table_schema NOT IN ('pg_catalog', 'information_schema')

UNION ALL

-- Part 3: Indexes (for performance tracking)
SELECT 
    'INDEX' as info_type,
    schemaname as table_schema,
    tablename as table_name,
    indexname as column_name,
    NULL as ordinal_position,
    NULL as data_type,
    NULL as character_maximum_length,
    NULL as numeric_precision,
    NULL as is_nullable,
    indexdef as column_default,
    indexname as constraint_name,
    'INDEX' as constraint_type,
    NULL as foreign_table,
    NULL as foreign_column,
    NULL as update_rule,
    NULL as delete_rule
FROM pg_indexes
WHERE schemaname NOT IN ('pg_catalog', 'information_schema')

ORDER BY table_schema, table_name, info_type, ordinal_position;